import{w as M,a as ee}from"./m78c574d5c3843a3d.js";import{I as D}from"./Icon.js";import{t as G,a as de,i as ce}from"./index.js";import{q as pe,r as ve,s as me,t as he,u as fe,f as ge,v as $e,w as ye,x as be,y as ke,z as Ce,A as Se,B as Pe,p as we}from"./m6cd080c8112b9076.js";import{s as Be}from"./m21bbc25c9f3922b4.js";import{p as Ie,c as Ve}from"./StringInput.js";import{D as se,a as De,M as Ne}from"./Modal.js";import{d as J,c as U,w as te,a as r,f as c,y as $,v as i,k as S,F as R,g as E,b as K,e as V,A as H,r as f,p as Me,G as Ae,D as ze,E as Re,q as Fe,n as ae}from"./mc55b2a42316522d6.js";import{r as y,u as m,v as _e}from"./m6bdda40d8bd2cf5a.js";import{K as _,n as F}from"./ma6cfd38af5d4c661.js";import{_ as Q}from"./_plugin-vue_export-helper.js";import{B as oe}from"./Button.js";import{a as je}from"./api.js";const Oe={class:"pagination-component"},Ue={key:0,class:"count"},Ee={key:1,"aria-label":"Page navigation",class:"pages"},Ke={class:"pagination pagination-sm"},Te={key:0,class:"page-link"},Le=["onClick"],qe={class:"per-page"},We=J({__name:"Pagination",props:{page:{default:1},perPage:{default:10},total:{default:0},pages:{},buttons:{default:5},sizes:{default:()=>[5,10,25,50]}},emits:["update:page","update:perPage","update:total","update:buttons","change"],setup(t,{expose:h,emit:d}){const a=y(t.page),n=y(t.page),o=y(t.perPage),C=U(()=>Math.ceil(t.total/o.value)),P=U(()=>Ie(a.value,t.perPage,t.total,t.buttons)),w=y(null);te([a,o],()=>{d("update:page",a),d("update:perPage",o),d("update:total",t.total),d("update:buttons",t.buttons),d("change",{page:a,perPage:o,total:t.total,pages:C.value,buttons:t.buttons})},{deep:!0}),te(o,()=>{a.value=1});const b=l=>{a.value=l},A=()=>{n.value++,n.value>C.value&&(n.value=1)},p=()=>{n.value--,n.value<1&&(n.value=C.value)},v=l=>{o.value=l,w.value.close()};return h({goTo:b,increment:A,decrement:p,changeSize:v}),(l,I)=>(r(),c("div",Oe,[l.total>0?(r(),c("div",Ue,_(m(G)(":?-:? of :? rows",l.perPage*a.value-(l.perPage-1),l.perPage*a.value<=l.total?l.perPage*a.value:l.total,l.total)),1)):$("",!0),P.value.length>1?(r(),c("nav",Ee,[i("ul",Ke,[i("li",{class:F(["page-item",{disabled:a.value===1}])},[i("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":"true",onClick:I[0]||(I[0]=M(g=>b(1),["prevent"]))},[S(D,{path:m(pe)},null,8,["path"])])],2),i("li",{class:F(["page-item",{disabled:a.value===1}])},[i("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":"true",onClick:I[1]||(I[1]=M(g=>b(a.value-1),["prevent"]))},[S(D,{path:m(ve)},null,8,["path"])])],2),(r(!0),c(R,null,E(P.value,g=>(r(),c("li",{class:F(["page-item",{active:g===a.value}]),key:g},[g===a.value?(r(),c("span",Te,_(g),1)):(r(),c("a",{key:1,class:"page-link",href:"#",onClick:M(B=>b(g),["prevent"])},_(g),9,Le))],2))),128)),i("li",{class:F(["page-item",{disabled:a.value===C.value}])},[i("a",{class:"page-link",href:"#",onClick:I[2]||(I[2]=M(g=>b(a.value+1),["prevent"]))},[S(D,{path:m(me)},null,8,["path"])])],2),i("li",{class:F(["page-item",{disabled:a.value===C.value}])},[i("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":"true",onClick:I[3]||(I[3]=M(g=>b(C.value),["prevent"]))},[S(D,{path:m(he)},null,8,["path"])])],2)])])):$("",!0),i("div",qe,[l.total>0?(r(),K(se,{key:0,ref_key:"dropDown",ref:w,title:`${l.perPage} ${m(G)("rows")}`,"auto-close":""},{default:V(()=>[(r(!0),c(R,null,E(l.sizes,(g,B)=>(r(),c(R,{key:g},[B===0||(l.sizes.at(B-1)??0)<=l.total?(r(),K(De,{key:0,onClick:M(j=>v(g),["prevent"])},{default:V(()=>[H(_(g)+" "+_(m(G)("rows")),1)]),_:2},1032,["onClick"])):$("",!0)],64))),128))]),_:1},8,["title"])):$("",!0)])]))}});const Ge=Q(We,[["__scopeId","data-v-2f185689"],["__file","Pagination.vue"]]),He={class:"input-group search-input-group"},Je=["placeholder","value","onKeydown"],Qe=["onClick"],Xe=J({__name:"Search",props:{modelValue:{}},emits:["update:modelValue","clear","search"],setup(t,{emit:h}){const d=o=>{h("update:modelValue",o.target.value.trim())},a=()=>{h("clear")},n=()=>{h("search")};return(o,C)=>(r(),c("div",He,[o.$slots["start-search"]?f(o.$slots,"start-search",{key:0}):$("",!0),o.modelValue!==""?(r(),c("button",{key:1,type:"button",class:"btn btn-primary",onClick:a},[S(D,{path:m(fe)},null,8,["path"])])):$("",!0),o.$slots["before-search"]?f(o.$slots,"before-search",{key:2}):$("",!0),i("input",{type:"text",class:"form-control",placeholder:m(G)("Search..."),value:o.modelValue,onInput:C[0]||(C[0]=P=>d(P)),onKeydown:[ee(M(n,["stop"]),["enter"]),ee(M(a,["stop"]),["esc"])]},null,40,Je),o.$slots["after-search"]?f(o.$slots,"after-search",{key:3}):$("",!0),i("button",{type:"button",class:"btn btn-primary",onClick:M(n,["prevent"])},[S(D,{path:m(ge)},null,8,["path"])],8,Qe),o.$slots["end-search"]?f(o.$slots,"end-search",{key:4}):$("",!0)]))}}),Ye=Q(Xe,[["__file","Search.vue"]]),Ze=t=>(ze("data-v-ad114dc7"),t=t(),Re(),t),xe={class:"row"},et={class:"col-md-5"},tt={class:"d-flex flex-horizontal gap-3"},at={class:"col-md-7"},st={class:"d-flex gap-2 justify-content-end align-items-center h-100"},ot={class:"table-responsive"},lt={key:0,class:"fitable no-select"},nt=Ze(()=>i("th",{class:"fitable no-select"},"#",-1)),rt=["onClick"],ut=["colspan"],it={key:0,class:"fitable no-select align-middle"},dt={class:"fitable no-select align-middle"},ct={key:1,class:"fitable no-select align-middle"},pt={class:"d-flex gap-2 align-items-start"},vt={key:2,class:"fitable no-select align-middle"},mt={key:0},ht=["colspan"],ft=J({__name:"Crud",props:{fields:{},fetch:{type:Function},keyName:{default:"id"},theme:{type:[Boolean,String],default:!1},orderBy:{type:[Boolean,String],default:!1}},emits:["empty","noEmpty"],setup(t,{expose:h,emit:d}){const a=U(()=>t.fields),n=Fe(),o=de(),{isDarkTheme:C}=Be(o),P=_e([]),w=y(1),b=y(5),A=y(""),p=y(t.orderBy||t.keyName),v=y(t.orderBy?!t.orderBy.startsWith("-"):!0),l=y(0),I=y(0),g=y(5),B=y({}),j=y(null),T=y(0),N=async()=>{var e,k,s,z;(k=(e=j.value)==null?void 0:e.start)==null||k.call(e);try{const u=await t.fetch({page:w.value,perPage:b.value,keyword:A.value,sort:`${v.value?"":"-"}${p.value}`.trim(),fields:a.value});P.value=u.data,l.value=(u==null?void 0:u.total)??0,w.value=(u==null?void 0:u.page)??1,b.value=(u==null?void 0:u.perPage)??1,I.value=(u==null?void 0:u.pages)??0,B.value={},P.value.length>0?d("noEmpty"):d("empty"),T.value++}catch{}(z=(s=j.value)==null?void 0:s.stop)==null||z.call(s)},L=async e=>{e.sortable&&(p.value=e.name,v.value=!v.value,N())},O=e=>{w.value=e.page.value,b.value=e.perPage.value,N()},q=()=>{w.value=1,N()},le=()=>{w.value=1,A.value="",N()},x=()=>{N()},X=e=>e.visible===void 0||e.visible,ne=U(()=>{var e,k,s,z,u,W;return t.fields.filter(ie=>X(ie)).length+1+((k=(e=n==null?void 0:n.proxy)==null?void 0:e.$slots)!=null&&k.actions?1:0)+((z=(s=n==null?void 0:n.proxy)==null?void 0:s.$slots)!=null&&z.moreActions?1:0)+((W=(u=n==null?void 0:n.proxy)==null?void 0:u.$slots)!=null&&W.details?1:0)}),re=e=>{B.value={...B.value,[e[t.keyName]]:!Y(e)}},Y=e=>Object.hasOwn(B.value,e[t.keyName])&&B.value[e[t.keyName]],ue=U(()=>{var e;return((e=P.value)==null?void 0:e.length)??0});return Me(()=>{N()}),h({refresh:x,length:()=>ue.value,data:()=>P.value}),(e,k)=>(r(),c("div",{class:"crud-component",key:`crud-${T.value}`},[f(e.$slots,"start",{},void 0,!0),i("div",xe,[i("div",et,[i("div",tt,[S(oe,{color:"primary",onClick:x,ref_key:"refresher",ref:j,"spinner-small":"","spinner-color":"light",style:{"min-width":"50px"}},{default:V(()=>[S(D,{path:m($e)},null,8,["path"])]),_:1},512),S(Ye,{modelValue:A.value,"onUpdate:modelValue":k[0]||(k[0]=s=>A.value=s),onClear:le,onSearch:q},Ae({_:2},[e.$slots.startSearch?{name:"start-search",fn:V(()=>[f(e.$slots,"startSearch",{},void 0,!0)]),key:"0"}:void 0,e.$slots.beforeSearch?{name:"before-search",fn:V(()=>[f(e.$slots,"beforeSearch",{},void 0,!0)]),key:"1"}:void 0,e.$slots.aftersearch?{name:"after-search",fn:V(()=>[f(e.$slots,"afterSearch",{},void 0,!0)]),key:"2"}:void 0,e.$slots.endSearch?{name:"end-search",fn:V(()=>[f(e.$slots,"endSearch",{},void 0,!0)]),key:"3"}:void 0]),1032,["modelValue"])])]),i("div",at,[i("div",st,[f(e.$slots,"topActions",{},void 0,!0)])])]),f(e.$slots,"before",{},void 0,!0),i("div",ot,[i("table",{class:F(["table table-bordered table-striped table-hover m-0",{"table-dark":!e.theme&&m(C)||e.theme&&e.theme==="dark"}])},[i("thead",null,[i("tr",null,[e.$slots.details?(r(),c("th",lt,"Â ")):$("",!0),nt,(r(!0),c(R,null,E(a.value,(s,z)=>(r(),c(R,{key:`${s.name}-${z}`},[X(s)?(r(),c("th",{key:0,class:F({fitable:s.fitable,"no-select":!0,pointer:s.sortable,"table-active":s.sortable&&p.value===s.name})},[i("div",{class:"d-flex gap-2",onClick:M(u=>L(s),["prevent","stop"])},[i("span",null,[f(e.$slots,`${s.name}Header`,{field:s},()=>[H(_(s.label),1)],!0)]),s.sortable&&p.value===s.name?(r(),K(D,{key:0,path:v.value?m(ye):m(be),class:F({"ms-auto":!0}),color:m(ce)()?"info":"primary"},null,8,["path","color"])):(r(),K(D,{key:1,path:m(ke),class:"ms-auto text-muted"},null,8,["path"]))],8,rt)],2)):$("",!0)],64))),128)),e.$slots.moreActions||e.$slots.actions?(r(),c("th",{key:1,colspan:e.$slots.moreActions&&e.$slots.actions?2:1,class:"fitable no-select"}," Actions ",8,ut)):$("",!0)])]),i("tbody",null,[(r(!0),c(R,null,E(P.value,(s,z)=>(r(),c(R,{key:s[e.keyName]},[i("tr",null,[e.$slots.details?(r(),c("td",it,[S(D,{path:Y(s)?m(Ce):m(Se),onClick:u=>re(s),class:"pointer"},null,8,["path","onClick"])])):$("",!0),i("td",dt,_(z+1),1),(r(!0),c(R,null,E(a.value,(u,W)=>(r(),c(R,{key:`${u.name}-${W}`},[X(u)?(r(),c("td",{key:0,class:F({fitable:u.fitable,"select-all":!0,"table-active":u.sortable&&p.value===u.name,border:u.sortable&&p.value===u.name,"align-middle":!0})},[f(e.$slots,`${u.name}Value`,{field:u,item:s},()=>[H(_(s[u.name]),1)],!0)],2)):$("",!0)],64))),128)),e.$slots.actions?(r(),c("td",ct,[i("div",pt,[f(e.$slots,"actions",{item:s},void 0,!0)])])):$("",!0),e.$slots.moreActions?(r(),c("td",vt,[S(se,{"no-arrow":"",div:""},{button:V(()=>[S(D,{path:m(Pe)},null,8,["path"])]),default:V(()=>[f(e.$slots,"moreActions",{item:s},void 0,!0)]),_:2},1024)])):$("",!0)]),e.$slots.details&&Y(s)?(r(),c("tr",mt,[i("td",{colspan:ne.value,class:"p-0 align-middle"},[f(e.$slots,"details",{item:s},void 0,!0)],8,ht)])):$("",!0)],64))),128))])],2)]),f(e.$slots,"after",{},void 0,!0),S(Ge,{page:w.value,"onUpdate:page":k[1]||(k[1]=s=>w.value=s),"per-page":b.value,"onUpdate:perPage":k[2]||(k[2]=s=>b.value=s),total:l.value,"onUpdate:total":k[3]||(k[3]=s=>l.value=s),buttons:g.value,"onUpdate:buttons":k[4]||(k[4]=s=>g.value=s),onChange:O},null,8,["page","per-page","total","buttons"]),f(e.$slots,"end",{},void 0,!0)]))}});const Rt=Q(ft,[["__scopeId","data-v-ad114dc7"],["__file","Crud.vue"]]);function Z(t,h=null){const d=[];let a;for(a in t)if(t.hasOwnProperty(a)){const n=h?`${h}[${a}]`:a,o=t[a];d.push(o!==null&&typeof o=="object"?Z(o,n):`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}return d.join("&")}var gt=(t=>(t.Number="number",t.String="string",t.Enum="enum",t))(gt||{});const $t=({data:t,header:h})=>({data:t,total:parseInt(h("x-pagination-total-count"))??0,page:parseInt(h("x-pagination-current-page"))??1,perPage:parseInt(h("x-pagination-per-page"))??1,pages:parseInt(h("x-pagination-page-count"))??0}),yt=(t,h)=>{if(t){let d=[];for(const a of h)if(a.searchable){const n={};a.type==="number"&&/^\d+\.{0,1}\d{0,}$/.test(t)?n[a.name]=t:(a.type==="string"||a.type==="enum")&&(n[a.name]={like:t}),Object.keys(n).length>0&&d.push(n)}return d={or:d},Z(d,"filter")}return""},Ft=(t,h,d)=>({page:a,perPage:n,sort:o,keyword:C,fields:P})=>new Promise((w,b)=>{const A=()=>{if(d&&Object.keys(d).length>0){let v=[];for(let l in d)typeof d[l]=="object"?v.push(Z(d[l],l)):v.push(`${l}=${d[l]}`);return`&${v.join("&")}`}return""},p=yt(C,P);je().get(`${t}?${h?`expand=${h}&`:""}page=${a}&per-page=${n}&sort=${o}${p?`&${p}`:""}${A()}`).then(v=>{w($t(v))}).catch(v=>{b(v)})}),_t=(...t)=>[...t],bt=J({inheritAttrs:!1,__name:"ModalForm",props:{modelClass:{type:Function},name:{},size:{default:null},fullscreen:{type:[Boolean,String],default:!1}},emits:["save"],setup(t,{expose:h,emit:d}){const a=y(null),n=y(null),[o,C,P]=Ve(t.modelClass),w=p=>{C({...p??{}}),ae(()=>{var v,l;(l=(v=a.value)==null?void 0:v.open)==null||l.call(v)})},b=()=>{var p,v,l,I;(I=(l=(v=(p=o.value)==null?void 0:p.validate)==null?void 0:v.call(p))==null?void 0:l.then)==null||I.call(l,g=>{var B,j;g&&o.value&&((j=(B=n.value)==null?void 0:B.start)==null||j.call(B),d("save",o.value,(T=!1)=>{var N,L;(L=(N=n.value)==null?void 0:N.stop)==null||L.call(N),T||ae(()=>{var O,q;(q=(O=a.value)==null?void 0:O.close)==null||q.call(O)})}))})},A=()=>{P()};return h({open:w}),(p,v)=>m(o)?(r(),K(Ne,{key:0,ref_key:"modal",ref:a,tag:"form",title:`${m(o).isNewRecord?"Add New":"Edit"} ${p.name}`,size:p.size,fullscreen:p.fullscreen,onSubmit:M(b,["prevent"]),onClosed:A},{header:V(()=>[f(p.$slots,"header")]),buttons:V(()=>[S(oe,{type:"submit",ref_key:"button",ref:n,color:"primary","spinner-color":"info",style:{height:"42px"}},{default:V(()=>[S(D,{path:m(we),color:"info"},null,8,["path"]),H("Save ")]),_:1},512)]),default:V(()=>[f(p.$slots,"default",{model:m(o)})]),_:3},8,["title","size","fullscreen","onSubmit"])):$("",!0)}}),jt=Q(bt,[["__file","ModalForm.vue"]]);export{Rt as C,gt as F,jt as M,_t as c,Ft as f};
//# sourceMappingURL=ModalForm.js.map
